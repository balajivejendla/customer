<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <div id="status">Disconnected</div>
    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
    <div id="logs"></div>

    <script>
        let socket = null;
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }

        function connect() {
            // Test token (you'll need to replace this with a real token)
            const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZXN0IiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiaWF0IjoxNzM3MDM5NjAwLCJleHAiOjE3MzcwNDMyMDAsImlzcyI6InRveGljaXR5LWFwaSIsImF1ZCI6InRveGljaXR5LWNsaWVudCJ9.test';
            
            log('Attempting to connect to ws://localhost:3001');
            
            socket = io('http://localhost:3001', {
                auth: {
                    token: testToken
                },
                transports: ['polling', 'websocket'],
                timeout: 20000
            });

            socket.on('connect', () => {
                log('‚úÖ Connected successfully!');
                statusDiv.textContent = 'Connected';
                statusDiv.style.color = 'green';
            });

            socket.on('disconnect', (reason) => {
                log(`‚ùå Disconnected: ${reason}`);
                statusDiv.textContent = 'Disconnected';
                statusDiv.style.color = 'red';
            });

            socket.on('connect_error', (error) => {
                log(`üö® Connection error: ${error.message}`);
                statusDiv.textContent = 'Error';
                statusDiv.style.color = 'red';
            });

            socket.on('authenticated', (data) => {
                log(`üîê Authenticated: ${JSON.stringify(data)}`);
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }
    </script>
</body>
</html>